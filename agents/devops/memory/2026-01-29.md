# 2026-01-29

## Prenotami Monitor Skill - Criação Completa

### Contexto
Markus pediu para criar um monitor para o sistema de agendamento de consulados italianos (Prenotami) baseado em conversa com amigo Fabio Kunckel. O sistema é muito concorrido - despachantes cobram R$600 para agendar.

### O que foi criado
Nova skill: `skills/prenotami-monitor/`

**Arquivos:**
- `SKILL.md` - Documentação principal
- `references/consulates.md` - Info de cada consulado brasileiro
- `scripts/monitor.ts` - Implementação principal (1737 linhas)
- `scripts/monitor.test.ts` - Unit tests (229 linhas)
- `scripts/package.json` - v2.1.0
- `scripts/tsconfig.json` - TypeScript config
- `scripts/Dockerfile` - Imagem Docker produção
- `scripts/docker-compose.yml` - Multi-cliente
- `scripts/setup.sh` - Script instalação
- `scripts/.env.example` - Template configuração

### Features implementadas
- ✅ Stealth browsing (25+ técnicas anti-detecção)
- ✅ User agent rotation (6 agentes)
- ✅ Human-like behavior (mouse Bezier, typing com typos)
- ✅ Session encryption (AES-256-GCM com salt aleatório)
- ✅ 2Captcha integration para CAPTCHA solving
- ✅ Auto-booking quando encontra vagas
- ✅ Proxy rotation (múltiplos proxies)
- ✅ Circuit breaker (para após N erros)
- ✅ Browser crash recovery (BrowserManager class)
- ✅ Health endpoint (/health, /ready, /metrics Prometheus)
- ✅ Graceful shutdown (SIGINT/SIGTERM)
- ✅ Multi-account support (ACCOUNT_ID)
- ✅ Docker deployment com resource limits
- ✅ Notificações via Moltbot (CLI + HTTP)

### Code Reviews
Foram feitos 2 code reviews via sub-agente:

**Review v1:** 3/10
- Muitos problemas de segurança e confiabilidade
- Stealth plugins não implementados
- Sem CAPTCHA solving real
- Sem auto-booking

**Review v2:** 7.5/10
- Melhorias significativas
- Issues restantes: salt estático, sem circuit breaker, proxy rotation incompleto

**Após correções v2.1:** ~8.5-9/10 estimado
- Todos os issues médios corrigidos
- Unit tests adicionados
- Prometheus metrics

### Modelo de negócio discutido
Cliente passa credenciais Prenotami → roda instância dedicada → monitor 24/7 → auto-booking ou alerta → cliente paga após agendamento confirmado

Similar ao modelo "Garantia Pátria" da empresa Pátria Italiana (R$599-699).

### Tecnologias
- TypeScript + Playwright
- Node.js 18+
- Docker + Docker Compose
- 2Captcha API
- Moltbot para notificações

### Próximos passos possíveis
- Testar em ambiente real
- Configurar para primeiro cliente (Fabio?)
- Adicionar mais consulados se necessário

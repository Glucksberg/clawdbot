# 2026-01-27 - CloudFarm Migration Project

## Context
Markus requested a comprehensive migration plan to move CloudFarm's AI tools from custom implementations to Clawdbot.

## Documents Created

### Migration Plan
- **Location:** `/home/dev/clawd/docs/cloudfarm-migration-plan.md`
- **Size:** ~100KB, 2,335 lines
- **Status:** Complete (all 6 sections documented)

### Sections:
1. **Claudinho (RAG Assistant)** - Custom GPT-5-mini + Pinecone → Clawdbot agent
2. **Error Analyzer** - Sentry webhooks + AI analysis → Clawdbot hooks + agent
3. **Self-Healing Scraper** - Puppeteer + GPT → browser tool + cron
4. **Code Retriever** - Pinecone → memory_search (eliminated)
5. **Alertas Telegram** - Custom → message tool (native)
6. **Cronograma** - 4-week implementation plan

### Projected Savings
- ~$109/month ($1,300/year)
- Code reduction: ~2,500 → ~400 lines (-84%)

## Implementation Started

### Section 1: Claudinho - IMPLEMENTED
- **Location:** `/home/dev/projects/CloudFarm/agents/claudinho/`
- **Branch:** `feature/clawdbot-section-1-claudinho` (in CloudFarm repo)
- **Files:** 13 files, ~1,700 lines
- **Code review:** Passed (all P0-P2 issues fixed)

**READ-ONLY Design:**
- Scripts only use `find()` and `aggregate()` - no writes
- MongoDB read-only user recommended
- Clawdbot tools: `write`, `edit` denied
- Workspace: `workspaceAccess: "ro"`

Key files:
- `SOUL.md` - Agent personality/rules
- `scripts/cf-query.js` - Secure MongoDB query helper (read-only)
- `scripts/cf-stats.js` - Aggregated stats helper (read-only)
- `memory/*.md` - Knowledge base (FAQs, flows, schemas, rules)

### Section 2: Error Analyzer - IMPLEMENTED
- **Location:** `/home/dev/projects/CloudFarm/agents/error-analyzer/`
- **Branch:** `feature/clawdbot-section-2-error-analyzer`
- **Files:** 9 files, ~1,600 lines
- **Commit:** f2ac210

Key files:
- `SOUL.md` - Agent personality and analysis rules
- `scripts/cf-error-dedupe.js` - Deduplication helper (4h window, tested)
- `memory/common-errors.md` - Known error patterns and fixes
- `memory/code-map.md` - Architecture reference

Features:
- Error deduplication (hash-based, 4h window)
- Known pattern matching via memory_search
- Risk classification (1-5 scale)
- Formatted Telegram alerts
- Dev/super_admin exclusion

### Section 3: Scraper Healer - IMPLEMENTED
- **Location:** `/home/dev/projects/CloudFarm/agents/scraper-healer/`
- **Branch:** `feature/clawdbot-section-3-scraper-healer`
- **Files:** 15 files, ~1,500 lines
- **Commit:** 32b4f58

Key files:
- `SOUL.md` - Agent workflow for health checks and healing
- `scripts/cf-extract.js` - CSS selector extraction (tested ✓)
- `scripts/cf-validate-selector.js` - Price range validation (tested ✓)
- `scraper-config.json` - 6 sources configured
- `memory/sites/*.md` - Known patterns for CEPEA, IMEA, Investing

Features:
- Periodic health check via cron
- Automatic selector discovery
- Price range validation
- Multi-site knowledge base
- Selector change history

### Remaining Sections
- Section 4: Code Retriever - ELIMINATED (uses memory_search)
- Section 5: Alertas Telegram - NATIVE (uses message tool)
- Section 6: Cronograma - Documentation only

## CloudFarm Repo Locations
- Main: `/home/dev/projects/CloudFarm`
- Backend: `/home/dev/projects/CloudFarm/apps/backend`
- Claudinho code: `apps/backend/src/services/claudinho_*.js`
- Error analyzer: `apps/backend/src/services/error_analyzer.js`, `ai_diagnostic.js`
- Scraper: `/home/dev/projects/CloudFarm/apps/api/src/services/selfHealingScraper.js`

## User Preferences
- Implementation via separate branches per section
- Code review after each section
- Approval before moving to next section
